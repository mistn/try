<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimalist Torment - æç®€æŠ˜ç£¨æµ (é¡¶çº§ä¼˜é›…ç‰ˆ)</title>
    <!-- ä½¿ç”¨ Tailwind CSS ä½œä¸ºåŸºç¡€æ ·å¼æ¡†æ¶ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont/style.css" media="print" onload="this.media='all'">
    
    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #000000;
            --transition-smooth: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow: hidden; 
            user-select: none;
            transition: filter 0.8s ease;
        }

        body.dark-mode { filter: invert(1) hue-rotate(180deg); }
        body.dark-mode img, body.dark-mode canvas, body.dark-mode #blackHoleContainer { filter: invert(1) hue-rotate(180deg); }

        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .glass-panel {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .font-wenkai {
            font-family: "LXGW WenKai Screen", serif;
            letter-spacing: 1px;
            line-height: 1.8;
        }

        /* ğŸŒŸ Aha ç‰¹æ•ˆï¼šQå¼¹é˜»å°¼å¼€å…³ */
        .ios-toggle {
            appearance: none; width: 50px; height: 30px; background: var(--text-color);
            border-radius: 30px; position: relative; cursor: pointer; outline: none;
            transition: 0.3s; border: 2px solid var(--text-color);
        }
        .ios-toggle::after {
            content: ''; position: absolute; top: 2px; left: 22px; width: 22px; height: 22px;
            background-color: var(--bg-color); border-radius: 50%;
            /* æœå†»å›å¼¹åŠ¨ç”» */
            transition: left 0.5s cubic-bezier(0.68, -0.6, 0.32, 1.6), background-color 0.3s;
        }
        .ios-toggle:not(:checked) { background: var(--bg-color); }
        .ios-toggle:not(:checked)::after { left: 2px; background-color: var(--text-color); }

        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%;
            background: #000; cursor: pointer; margin-top: -8px; box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; cursor: pointer; background: #e5e7eb; border-radius: 2px;
        }

        @keyframes toastFade {
            0% { opacity: 0; transform: translate(-50%, -20px); }
            10% { opacity: 1; transform: translate(-50%, 0); }
            90% { opacity: 1; transform: translate(-50%, 0); }
            100% { opacity: 0; transform: translate(-50%, -20px); }
        }
        .toast-anim { animation: toastFade var(--toast-duration, 3s) forwards; }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px) rotate(-1deg); }
            40%, 80% { transform: translateX(5px) rotate(1deg); }
        }
        .shake-anim { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; color: #dc2626; }

        #spotlightOverlay {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: radial-gradient(circle 200px at var(--x, 50%) var(--y, 50%), transparent 0%, rgba(0,0,0,0.85) 100%);
            pointer-events: none; z-index: 40; opacity: 0; transition: opacity 0.5s ease;
        }
        .spotlight-active #spotlightOverlay { opacity: 1; }
        .spotlight-target { position: relative; z-index: 50 !important; background: white; border-radius: 8px; padding: 0 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }

        .step-container {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: opacity 0.8s ease;
        }
        .step-container.active { opacity: 1; pointer-events: auto; }

        #pullCord {
            position: fixed; top: -10px; right: 80px; width: 4px; height: 120px;
            background: #d1d5db; z-index: 100; transform-origin: top center; cursor: grab;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1); touch-action: none;
        }
        #pullCord::after {
            content: ''; position: absolute; bottom: -12px; left: -6px; width: 16px; height: 16px;
            background: #9ca3af; border-radius: 50%; box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        .cord-swing { animation: swing 1s cubic-bezier(0.25, 1, 0.5, 1); }
        @keyframes swing {
            0% { transform: rotate(0deg) scaleY(1); }
            30% { transform: rotate(5deg) scaleY(1.1); }
            60% { transform: rotate(-3deg) scaleY(0.95); }
            80% { transform: rotate(1deg) scaleY(1.02); }
            100% { transform: rotate(0deg) scaleY(1); }
        }

        .scratch-container { position: relative; width: 160px; height: 40px; }
        #scratchCanvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: pointer; z-index: 10; border-radius: 4px; }
        #secretPasswordDisplay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-family: monospace; font-size: 1.2rem; letter-spacing: 2px; color: black; background: #f3f4f6; border-radius: 4px; z-index: 5; border: 1px dashed #ccc;}

        #blackHole {
            width: 150px; height: 150px; border-radius: 50%; background: radial-gradient(circle at center, #000 0%, #1a1a1a 40%, transparent 70%);
            box-shadow: 0 0 50px 20px rgba(0,0,0,0.8), inset 0 0 20px rgba(255,255,255,0.2);
            animation: rotateHole 4s linear infinite; display: flex; align-items: center; justify-content: center;
        }
        @keyframes rotateHole { 100% { transform: rotate(360deg); } }
        .sucked-in { transform: scale(0) rotate(720deg) !important; opacity: 0 !important; filter: blur(10px); transition: all 1s cubic-bezier(0.5, 0, 0, 1) !important; }

        /* ğŸŒŸ Aha ç‰¹æ•ˆï¼šç£å¸æŒ‰é’® */
        .magnetic-btn {
            transition: transform 0.4s cubic-bezier(0.25, 1, 0.5, 1);
            will-change: transform;
        }
    </style>
</head>
<body class="w-screen h-screen relative">

    <div id="spotlightOverlay"></div>
    <div id="pullCord" title="å¾€ä¸‹æ‹‰è¯•è¯•"></div>

    <div id="failCounterWidget" class="fixed bottom-6 right-8 z-40 text-[10px] text-gray-300 font-mono tracking-widest hidden transition-opacity duration-1000">
        FRUSTRATION INDEX: <span id="failCount" class="text-black font-bold">0</span>
    </div>

    <div id="toast" class="fixed top-10 left-1/2 z-50 hidden glass-panel px-6 py-3 rounded-full text-sm font-medium tracking-widest pointer-events-none text-black border border-gray-200 shadow-sm whitespace-nowrap"></div>

    <!-- å…³å¡ 1ï¼šç¤¾æå…³é—­é”® -->
    <div id="step1" class="step-container active bg-gray-50/50">
        <div class="glass-panel w-[min(400px,88vw)] h-[min(300px,60vh)] rounded-3xl flex flex-col items-center justify-center relative shadow-2xl">
            <button id="runawayBtn" class="absolute top-5 right-5 w-8 h-8 flex items-center justify-center rounded-full text-gray-400 hover:text-black transition-colors" style="transition: transform 0.4s cubic-bezier(0.25, 1, 0.5, 1);">
                <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M1 1L13 13M1 13L13 1"></path></svg>
            </button>
            <h1 class="text-3xl font-light tracking-tight mb-4 kinetic-title inline-block">æ¬¢è¿æ¢ç´¢æœªçŸ¥</h1>
            <p class="text-sm text-gray-500 tracking-widest uppercase">CLOSE TO CONTINUE</p>
        </div>
    </div>

    <!-- å…³å¡ 2ï¼šé˜²å‡è¯»åè®® + ğŸŒŸ Aha æ¢ç…§ç¯é€è§†é•œ -->
    <div id="step2" class="step-container bg-white">
        <div class="w-[min(500px,92vw)] h-[75vh] max-h-[600px] flex flex-col relative">
            <h2 class="text-2xl font-bold mb-6 text-center tracking-tighter kinetic-title inline-block origin-bottom">æœåŠ¡æ¡æ¬¾</h2>
            
            <!-- é€è§†é•œç»“æ„åŒ…è£¹å™¨ -->
            <div id="tosContainer" class="flex-1 overflow-y-auto hide-scrollbar border-y border-gray-100 relative bg-white">
                <!-- å¹½çµå±‚ï¼šç”¨äºæ’‘å¼€æ»šåŠ¨æ¡é«˜åº¦ -->
                <div id="tosGhost" class="w-full py-6 px-4 font-wenkai text-transparent select-none pointer-events-none"></div>
                
                <!-- æ¨¡ç³ŠèƒŒæ™¯å±‚ -->
                <div id="tosBlurred" class="absolute top-0 left-0 w-full py-6 px-4 font-wenkai text-gray-800 blur-[5px] opacity-40 select-none pointer-events-none"></div>
                
                <!-- æ¸…æ™°é®ç½©å±‚ï¼šåªæœ‰é¼ æ ‡é™„è¿‘å¯è§ -->
                <div id="tosClear" class="absolute top-0 left-0 w-full py-6 px-4 font-wenkai text-gray-800 select-none pointer-events-none" 
                     style="-webkit-mask-image: radial-gradient(circle 80px at var(--mx, -100px) var(--my, -100px), black 40%, transparent 100%);">
                </div>
            </div>

            <div class="mt-6 flex justify-center z-10">
                <button id="agreeBtn" class="magnetic-btn px-8 py-3 bg-gray-200 text-gray-400 rounded-full text-sm font-semibold tracking-widest cursor-not-allowed transition-colors duration-500">
                    æˆ‘å·²ä»”ç»†é˜…è¯»
                </button>
            </div>
        </div>
    </div>

    <!-- å…³å¡ 3ï¼šæ‰‹æœºå·æ»‘åŠ¨æ¡åœ°ç‹± + éªŒè¯ç é™·é˜± -->
    <div id="step3" class="step-container bg-white">
        <div class="w-[min(500px,92vw)] flex flex-col items-center">
            <h2 class="text-3xl font-bold mb-2 tracking-tighter kinetic-title inline-block origin-bottom">ç»‘å®šæ‰‹æœº</h2>
            
            <div id="step3-state1" class="w-full flex flex-col items-center transition-opacity duration-500">
                <p class="text-sm text-gray-400 mb-10 text-center">ä¸ºäº†æ‚¨çš„å®‰å…¨ï¼Œè¯·æ‹–åŠ¨æ»‘å—é€‰æ‹©æ‚¨çš„çœŸå®æ‰‹æœºå·ç ã€‚</p>
                <div class="text-4xl font-mono tracking-widest mb-8 text-black" id="phoneDisplay">13000000000</div>
                <input type="range" id="phoneSlider" min="13000000000" max="19999999999" value="13000000000" step="1" class="w-full mb-6">
                <p class="text-xs text-gray-400 mb-12">ï¼ˆç¦ç”¨äº†é”®ç›˜è¾“å…¥ï¼‰</p>
                <button id="sendCodeBtn" class="magnetic-btn px-10 py-3 bg-black text-white rounded-full text-sm font-semibold tracking-widest hover:scale-105">
                    å‘é€éªŒè¯ç 
                </button>
            </div>

            <div id="step3-state2" class="w-full flex flex-col items-center hidden opacity-0 transition-opacity duration-500 absolute top-1/2 -translate-y-1/2">
                <p class="text-sm text-gray-400 mb-6 text-center">çŸ­ä¿¡éªŒè¯ç å·²å‘é€è‡³ï¼š<br><span id="confirmPhoneDisplay" class="text-2xl font-mono font-bold text-black mt-3 inline-block tracking-widest"></span></p>
                <input type="text" id="smsCodeInput" placeholder="ç‚¹å‡»è¾“å…¥" maxlength="6" class="w-2/3 border-b border-gray-300 py-3 text-center text-xl focus:outline-none transition-colors bg-transparent mb-8 tracking-[0.5em] font-mono" data-spotlight="true">
                <button id="verifyCodeBtn" class="magnetic-btn px-10 py-3 bg-black text-white rounded-full text-sm font-semibold tracking-widest hover:scale-105 mb-6">
                    éªŒè¯å¹¶ç»§ç»­
                </button>
                <button id="backToPhoneBtn" class="text-xs text-gray-400 hover:text-black underline underline-offset-4 transition-colors">
                    æ”¶ä¸åˆ°çŸ­ä¿¡ï¼Ÿè¿”å›ä¿®æ”¹å·ç 
                </button>
            </div>
        </div>
    </div>

    <!-- å…³å¡ 4ï¼šä¿„ç½—æ–¯å¥—å¨ƒ + æƒ…ç»ªéœ‡åŠ¨ + åˆ®åˆ®ä¹ -->
    <div id="step4" class="step-container bg-white">
        <div class="w-[min(450px,92vw)] flex flex-col">
            <h2 class="text-3xl font-bold mb-2 tracking-tighter kinetic-title inline-block origin-bottom">è®¾ç½®å¯†é’¥</h2>
            <p class="text-sm text-gray-400 mb-8">å¸¦æƒ…ç»ªçš„ç¬¦å·ä¼šå¼•èµ·ä¸é€‚ï¼Œè¯·ä¿æŒå†·é™ã€‚</p>
            
            <div class="flex items-end gap-4 mb-6">
                <input type="password" id="passwordInput" placeholder="è¾“å…¥å¯†ç ..." class="flex-1 border-b border-gray-300 py-3 text-lg focus:outline-none transition-colors bg-transparent placeholder-gray-300" data-spotlight="true">
                <div class="scratch-container" title="åˆ®å¼€æ¶‚å±‚æŸ¥çœ‹å¯†ç ">
                    <div id="secretPasswordDisplay">****</div>
                    <canvas id="scratchCanvas"></canvas>
                </div>
            </div>

            <div id="rulesContainer" class="flex flex-col gap-3 text-sm"></div>
            <button id="pwdNextBtn" class="magnetic-btn mt-10 px-8 py-3 bg-black text-white rounded-full text-sm font-semibold opacity-0 pointer-events-none transition-opacity duration-500 self-start hover:scale-105">
                ç»§ç»­å‘å &rarr;
            </button>
        </div>
    </div>

    <!-- å…³å¡ 5ï¼šé€šç”µç«çº¿äººæœºéªŒè¯ -->
    <div id="step5" class="step-container bg-gray-50">
        <div class="w-[min(600px,92vw)] glass-panel p-5 sm:p-10 rounded-3xl flex flex-col items-center">
            <h2 class="text-xl font-semibold mb-2 tracking-wide kinetic-title inline-block origin-bottom">è½¨è¿¹éªŒè¯</h2>
            <p class="text-xs text-gray-500 mb-8">è¯·æ²¿è½¨è¿¹æ‹–åŠ¨é»‘ç‚¹è‡³ç»ˆç‚¹ã€‚åç¦»è½¨è¿¹å°†é‡ç½®ã€‚</p>
            <div class="relative w-full h-[150px] border border-gray-100 rounded-xl bg-white flex items-center justify-center overflow-hidden">
                <svg id="captchaSvg" class="absolute w-full h-full pointer-events-none" viewBox="0 0 500 150">
                    <path d="M 50,75 C 150,180 350,-30 450,75" fill="none" stroke="#d1d5db" stroke-width="2" stroke-linecap="round" class="pointer-events-none" />
                    <path id="captchaPath" d="M 50,75 C 150,180 350,-30 450,75" fill="none" stroke="rgba(0,0,0,0.01)" stroke-width="16" stroke-linecap="round" style="pointer-events: stroke;" class="pointer-events-auto" />
                    <circle cx="450" cy="75" r="8" fill="none" stroke="#000" stroke-width="2"/>
                </svg>
                <div id="captchaDot" class="absolute w-5 h-5 bg-black rounded-full cursor-grab" style="left: 40px; top: 65px; transition: box-shadow 0.2s; touch-action: none;"></div>
            </div>
        </div>
    </div>

    <!-- å…³å¡ 6ï¼šç‰µä¸€å‘è€ŒåŠ¨å…¨èº« (ç‚¹ç¯æ¸¸æˆ) -->
    <div id="step6" class="step-container bg-white">
        <div class="w-[min(400px,88vw)] flex flex-col items-center">
            <h2 class="text-2xl font-bold mb-2 tracking-tighter kinetic-title inline-block origin-bottom">éšç§åå¥½</h2>
            <p class="text-sm text-gray-500 mb-10 text-center">ç³»ç»Ÿé»˜è®¤å¼€å¯æ‰€æœ‰è®¢é˜…ã€‚<br>å¦‚éœ€å–æ¶ˆï¼Œè¯·å…³é—­ä»¥ä¸‹æ‰€æœ‰å¼€å…³ã€‚</p>
            <div class="grid grid-cols-3 gap-x-8 gap-y-10" id="toggleGrid"></div>
            <button id="resetStep6Btn" class="mt-8 text-xs text-gray-400 hover:text-black transition-colors underline underline-offset-4 tracking-widest">
                é‡ç½®æ‰€æœ‰å¼€å…³
            </button>
            <button id="finalSubmitBtn" class="magnetic-btn mt-6 px-10 py-3 bg-black text-white rounded-full text-sm font-semibold tracking-widest opacity-30 pointer-events-none transition-all duration-500 hover:scale-105">
                ç”Ÿæˆæ¡£æ¡ˆ
            </button>
        </div>
    </div>

    <!-- å…³å¡ 7ï¼šé»‘æ´é”€æ¯ç»“å±€ -->
    <div id="step7" class="step-container bg-gray-100">
        <div id="blackHoleContainer" class="absolute top-1/4 flex flex-col items-center">
            <p class="text-gray-500 mb-6 font-mono tracking-widest text-sm uppercase">Trash Can / é”€æ¯åŒº</p>
            <div id="blackHole"></div>
        </div>
        <div id="archiveCard" class="absolute bottom-1/4 w-[min(300px,80vw)] bg-white rounded-xl shadow-xl border border-gray-200 p-6 flex flex-col cursor-grab transition-transform" style="touch-action: none;">
            <div class="border-b border-gray-100 pb-3 mb-3 flex justify-between items-center">
                <h3 class="font-bold text-lg">æ‚¨çš„ç»å¯†æ¡£æ¡ˆ</h3>
                <span class="text-xs bg-red-100 text-red-600 px-2 py-1 rounded">ä¸å¯é€†</span>
            </div>
            <p class="text-sm text-gray-500 mb-2">ç»è¿‡é‡é‡æŠ˜ç£¨ï¼Œæ¡£æ¡ˆå·²ç”Ÿæˆã€‚</p>
            <p class="text-xs text-gray-400">æ‹–è¿›ä¸Šæ–¹é»‘æ´ã€‚</p>
        </div>
        <div id="victoryText" class="absolute inset-0 flex flex-col items-center justify-center opacity-0 pointer-events-none transition-opacity duration-1000 z-50">
            <h1 class="text-6xl font-black tracking-tighter mb-6 text-black kinetic-title inline-block">You Survived.</h1>
            <div class="bg-white/90 rounded-2xl px-8 py-6 shadow-sm text-center" style="max-width:280px">
                <p class="text-xs font-mono tracking-[0.2em] text-gray-400 uppercase mb-4">æŠ˜ç£¨æŠ¥å‘Š</p>
                <div class="flex justify-around gap-6 mb-4">
                    <div><div id="finalFailCount" class="text-3xl font-black">0</div><div class="text-xs text-gray-400 mt-1">å¤±è´¥æ¬¡æ•°</div></div>
                    <div><div id="finalMinutes" class="text-3xl font-black">-</div><div class="text-xs text-gray-400 mt-1">æµªè´¹åˆ†é’Ÿ</div></div>
                </div>
                <p class="text-xs text-gray-400">ä¸‹æ¬¡åˆ«ç‚¹è¿›æ¥äº†</p>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // ğŸŒŸ Aha ç‰¹æ•ˆ 1ï¼šæµä½“åŠ¨åŠ›å­¦æ ‡é¢˜ (Kinetic Typography)
        // ==========================================
        let mouseX = 0;
        let skewTarget = 0;
        let currentSkewVal = 0;
        window.addEventListener('mousemove', (e) => {
            skewTarget = (e.clientX - mouseX) * 0.05; // é€Ÿåº¦ç¼©æ”¾å› å­
            mouseX = e.clientX;
        });
        function animateSkew() {
            currentSkewVal += (skewTarget - currentSkewVal) * 0.1; // å¼¹ç°§ç¼“åŠ¨
            document.querySelectorAll('.kinetic-title').forEach(el => {
                // é™åˆ¶æœ€å¤§å€¾æ–œè§’åº¦é¿å…å¤ªå¤¸å¼ 
                const clampedSkew = Math.max(-15, Math.min(15, -currentSkewVal));
                el.style.transform = `skewX(${clampedSkew}deg)`;
            });
            skewTarget *= 0.9; // é˜»å°¼è¡°å‡
            requestAnimationFrame(animateSkew);
        }
        animateSkew();

        // ==========================================
        // ğŸŒŸ Aha ç‰¹æ•ˆ 2ï¼šç£å¸æŒ‰é’® (iPadOS é£æ ¼)
        // ==========================================
        document.querySelectorAll('.magnetic-btn').forEach(btn => {
            btn.addEventListener('mousemove', function(e) {
                // å¦‚æœæŒ‰é’®æ˜¯ç¦ç”¨çŠ¶æ€åˆ™ä¸å¸é™„
                if(this.classList.contains('cursor-not-allowed') || this.classList.contains('pointer-events-none')) return;
                const rect = this.getBoundingClientRect();
                const x = e.clientX - rect.left - rect.width / 2;
                const y = e.clientY - rect.top - rect.height / 2;
                this.style.transform = `translate(${x * 0.3}px, ${y * 0.3}px)`;
                this.style.transition = 'none'; // ç¬é—´è·Ÿéš
            });
            btn.addEventListener('mouseleave', function() {
                this.style.transform = 'translate(0px, 0px)';
                this.style.transition = 'transform 0.4s cubic-bezier(0.25, 1, 0.5, 1)'; // ä¼˜é›…å›å¼¹
            });
        });

        // ==========================================
        // åˆå§‹åŒ–æœåŠ¡æ¡æ¬¾å†…å®¹ (å¡«å……æ–‡å­—)
        // ==========================================
        const tosContentStr = Array(30).fill(0).map((_, i) => `<p class="mb-4">ç¬¬ ${i+1} æ¡ï¼šç”¨æˆ·ä¸å¾—ä½¿ç”¨ä»»ä½•è‡ªåŠ¨åŒ–è„šæœ¬æˆ–å¿«é€Ÿæ»šåŠ¨è®¾å¤‡è·³è¿‡æœ¬åè®®ã€‚è‹¥ç³»ç»Ÿæ£€æµ‹åˆ°æ‚¨çš„é˜…è¯»é€Ÿåº¦è¶…è¿‡äººç±»ç”Ÿç†æé™ï¼Œç³»ç»Ÿå°†å‡ºäºå¯¹æ‚¨è§†åŠ›ä¿æŠ¤çš„è€ƒè™‘ï¼Œè‡ªåŠ¨å°†æ‚¨çš„é˜…è¯»è¿›åº¦é‡ç½®ä¸ºé›¶ã€‚è¿™ç§è®¾è®¡å¹¶éå‡ºäºæ¶æ„ï¼Œè€Œæ˜¯æˆ‘ä»¬å¯¹å¤å…¸é˜…è¯»ç²¾ç¥çš„ä¸€ç§ç°ä»£è‡´æ•¬ã€‚è¯·æ‚¨æ·±å‘¼å¸ï¼Œæ„Ÿå—æ±‰å­—ä¹‹ç¾ï¼Œä¸€å­—ä¸€å¥åœ°å‘ä¸‹æµè§ˆã€‚</p>`).join('');
        document.getElementById('tosGhost').innerHTML = tosContentStr + '<div id="tosBottom" class="h-10 w-full"></div>';
        document.getElementById('tosBlurred').innerHTML = tosContentStr;
        document.getElementById('tosClear').innerHTML = tosContentStr;

        // ==========================================
        // ğŸŒŸ Aha ç‰¹æ•ˆ 3ï¼šæ¢ç…§ç¯é˜…è¯»å™¨ (æ¯›ç»ç’ƒé€è§†)
        // ==========================================
        const tosContainer = document.getElementById('tosContainer');
        const tosClear = document.getElementById('tosClear');
        tosContainer.addEventListener('mousemove', (e) => {
            if (!document.getElementById('step2').classList.contains('active')) return;
            const rect = tosContainer.getBoundingClientRect();
            const x = e.clientX - rect.left;
            // Yåæ ‡éœ€è¦åŠ ä¸Šæ»šåŠ¨æ¡çš„åç§»é‡ï¼Œè®©å…‰åœˆåœ¨å®¹å™¨å†…å‡†ç¡®è·Ÿéšå†…å®¹
            const y = e.clientY - rect.top + tosContainer.scrollTop; 
            tosClear.style.setProperty('--mx', `${x}px`);
            tosClear.style.setProperty('--my', `${y}px`);
        });

        // ==========================================
        // ä»¥ä¸‹ä¸ºåŸºç¡€é€»è¾‘ä¸åŸæœ‰äº¤äº’ä»£ç 
        // ==========================================
        let failData = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0 };
        let totalFails = 0;
        const startTime = Date.now();
        const failCounterWidget = document.getElementById('failCounterWidget');
        const failCountDisplay = document.getElementById('failCount');
        let toastTimeout;

        function showToast(msg, durationMs = 3000) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.classList.remove('hidden', 'toast-anim');
            void toast.offsetWidth; 
            toast.style.setProperty('--toast-duration', (durationMs / 1000) + 's');
            toast.classList.add('toast-anim');
            clearTimeout(toastTimeout);
            toastTimeout = setTimeout(() => {
                toast.classList.add('hidden');
                toast.classList.remove('toast-anim');
            }, durationMs);
        }

        function recordFail(stepNum, threshold, hintMessage, hintDuration = 5000) {
            failData[stepNum]++;
            totalFails++;
            failCounterWidget.classList.remove('hidden');
            failCountDisplay.textContent = totalFails;
            if (failData[stepNum] === threshold) showToast(hintMessage, hintDuration);
        }

        function goToStep(stepNum) {
            document.querySelectorAll('.step-container').forEach(el => el.classList.remove('active'));
            document.getElementById('step' + stepNum).classList.add('active');
            if(stepNum === 4) initScratchCard();
        }

        // ç‰©ç†æ‹‰ç»³ (æš—é»‘æ¨¡å¼)
        const pullCord = document.getElementById('pullCord');
        let isCordDragging = false, startCordY = 0;
        pullCord.addEventListener('mousedown', (e) => {
            isCordDragging = true; startCordY = e.clientY;
            pullCord.style.cursor = 'grabbing'; pullCord.classList.remove('cord-swing');
        });
        window.addEventListener('mousemove', (e) => {
            if (!isCordDragging) return;
            const dy = Math.max(0, e.clientY - startCordY);
            pullCord.style.transform = `scaleY(${1 + dy/200})`;
            if (dy > 80) {
                isCordDragging = false; pullCord.style.cursor = 'grab';
                document.body.classList.toggle('dark-mode');
                pullCord.style.transform = ''; pullCord.classList.add('cord-swing');
                if(navigator.vibrate) navigator.vibrate(50);
            }
        });
        window.addEventListener('mouseup', () => {
            if (isCordDragging) {
                isCordDragging = false; pullCord.style.cursor = 'grab';
                pullCord.style.transform = ''; pullCord.classList.add('cord-swing');
            }
        });
        pullCord.addEventListener('touchstart', (e) => {
            isCordDragging = true; startCordY = e.touches[0].clientY;
            pullCord.classList.remove('cord-swing');
        }, { passive: true });
        pullCord.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const dy = Math.max(0, e.touches[0].clientY - startCordY);
            pullCord.style.transform = `scaleY(${1 + dy/200})`;
            if (dy > 80) {
                isCordDragging = false;
                document.body.classList.toggle('dark-mode');
                pullCord.style.transform = ''; pullCord.classList.add('cord-swing');
                if(navigator.vibrate) navigator.vibrate(50);
            }
        }, { passive: false });
        pullCord.addEventListener('touchend', () => {
            if (isCordDragging) {
                isCordDragging = false;
                pullCord.style.transform = ''; pullCord.classList.add('cord-swing');
            }
        });

        // èšå…‰ç¯è¡¨å•å¼•åŠ›åœº
        const spotlightInputs = document.querySelectorAll('[data-spotlight="true"]');
        const spotlightOverlay = document.getElementById('spotlightOverlay');
        spotlightInputs.forEach(input => {
            input.addEventListener('focus', (e) => {
                document.body.classList.add('spotlight-active'); e.target.classList.add('spotlight-target');
                updateSpotlight(e);
            });
            input.addEventListener('blur', (e) => {
                document.body.classList.remove('spotlight-active'); e.target.classList.remove('spotlight-target');
            });
        });
        document.addEventListener('mousemove', (e) => {
            if (document.body.classList.contains('spotlight-active')) updateSpotlight(e);
        });
        function updateSpotlight(e) {
            spotlightOverlay.style.setProperty('--x', `${e.clientX}px`);
            spotlightOverlay.style.setProperty('--y', `${e.clientY}px`);
        }

        // å…³å¡ 1ï¼šç¤¾æé€ƒè·‘æŒ‰é’®
        const runawayBtn = document.getElementById('runawayBtn');
        let lastMousePos = { x: 0, y: 0 }; let lastMouseTime = Date.now();
        document.addEventListener('mousemove', (e) => {
            if (!document.getElementById('step1').classList.contains('active')) return;
            const now = Date.now(); const dt = Math.max(now - lastMouseTime, 1);
            const dx = e.clientX - lastMousePos.x; const dy = e.clientY - lastMousePos.y;
            const speed = Math.sqrt(dx*dx + dy*dy) / dt; 
            const btnRect = runawayBtn.getBoundingClientRect();
            const btnCenter = { x: btnRect.left + btnRect.width/2, y: btnRect.top + btnRect.height/2 };
            const distToBtn = Math.sqrt(Math.pow(e.clientX - btnCenter.x, 2) + Math.pow(e.clientY - btnCenter.y, 2));

            if (speed > 0.3 && distToBtn < 150) {
                const parentRect = runawayBtn.parentElement.getBoundingClientRect();
                const newX = Math.random() * (parentRect.width - 40) - (parentRect.width/2 - 20);
                const newY = Math.random() * (parentRect.height - 40) - (parentRect.height/2 - 20);
                runawayBtn.style.transform = `translate(${newX}px, ${newY}px)`;
                recordFail(1, 10, "æç¤ºï¼šæ…¢æ…¢ç§»è¿‡å»");
            }
            lastMousePos = { x: e.clientX, y: e.clientY }; lastMouseTime = now;
        });
        runawayBtn.addEventListener('click', () => { goToStep(2); });

        // å…³å¡ 2ï¼šé˜²å‡è¯»æ»šåŠ¨æ¡
        const agreeBtn = document.getElementById('agreeBtn');
        let isTosRead = false;
        tosContainer.addEventListener('wheel', (e) => {
            if (!document.getElementById('step2').classList.contains('active')) return;
            if (e.deltaY > 60) {
                e.preventDefault(); tosContainer.scrollTo({ top: 0, behavior: 'smooth' });
                showToast("è¯»å¤ªå¿«äº†ï¼Œé‡æ¥");
                recordFail(2, 5, "æç¤ºï¼šç‚¹å‡»æ–‡å­—åŒºï¼Œç”¨ â†“ é”®ç¿»åˆ°åº•");
            }
        }, { passive: false });
        window.addEventListener('keydown', (e) => {
            if (!document.getElementById('step2').classList.contains('active')) return;
            if (e.key === 'ArrowDown') {
                e.preventDefault();
                tosContainer.scrollBy({ top: 8, behavior: 'auto' });
            }
        });

        tosContainer.addEventListener('scroll', () => {
            if (tosContainer.scrollHeight - tosContainer.scrollTop - tosContainer.clientHeight < 10) {
                if (!isTosRead) {
                    isTosRead = true;
                    agreeBtn.classList.remove('bg-gray-200', 'text-gray-400', 'cursor-not-allowed');
                    agreeBtn.classList.add('bg-black', 'text-white', 'cursor-pointer');
                }
            }
        });
        agreeBtn.addEventListener('click', () => { if (isTosRead) goToStep(3); });

        // å…³å¡ 3ï¼šæ‰‹æœºæ»‘åŠ¨æ¡ + éªŒè¯ç é™·é˜±
        const phoneSlider = document.getElementById('phoneSlider'), phoneDisplay = document.getElementById('phoneDisplay');
        const sendCodeBtn = document.getElementById('sendCodeBtn'), step3State1 = document.getElementById('step3-state1');
        const step3State2 = document.getElementById('step3-state2'), confirmPhoneDisplay = document.getElementById('confirmPhoneDisplay');
        const smsCodeInput = document.getElementById('smsCodeInput'), verifyCodeBtn = document.getElementById('verifyCodeBtn'), backToPhoneBtn = document.getElementById('backToPhoneBtn');

        phoneSlider.addEventListener('input', (e) => { phoneDisplay.textContent = e.target.value; });
        phoneSlider.addEventListener('change', (e) => {
            let val = parseInt(e.target.value), offset = Math.floor(Math.random() * 31) - 15;
            if (offset === 0) offset = 5; 
            val += offset; phoneSlider.value = val; phoneDisplay.textContent = val;
            showToast("æ‰‹æŠ–äº†");
        });

        let smsCountdownTimer = null;
        function startSmsCountdown() {
            clearInterval(smsCountdownTimer);
            let countVal = 60;
            sendCodeBtn.textContent = `é‡å‘ (${countVal}s)`;
            sendCodeBtn.disabled = true; sendCodeBtn.classList.add('opacity-50', 'cursor-not-allowed'); sendCodeBtn.classList.remove('hover:scale-105');
            smsCountdownTimer = setInterval(() => {
                countVal = Math.max(0, countVal - 0.3);
                sendCodeBtn.textContent = `é‡å‘ (${Math.ceil(countVal)}s)`;
                if (countVal <= 0) {
                    clearInterval(smsCountdownTimer);
                    sendCodeBtn.textContent = 'é‡æ–°å‘é€'; sendCodeBtn.disabled = false;
                    sendCodeBtn.classList.remove('opacity-50', 'cursor-not-allowed'); sendCodeBtn.classList.add('hover:scale-105');
                }
            }, 1000);
        }
        sendCodeBtn.addEventListener('click', () => {
            step3State1.classList.add('opacity-0');
            setTimeout(() => {
                step3State1.classList.add('hidden'); step3State2.classList.remove('hidden');
                confirmPhoneDisplay.textContent = phoneSlider.value; 
                setTimeout(() => step3State2.classList.remove('opacity-0'), 50);
            }, 500);
            showToast("å·²å‘é€");
            startSmsCountdown();
        });

        backToPhoneBtn.addEventListener('click', () => {
            step3State2.classList.add('opacity-0');
            setTimeout(() => {
                step3State2.classList.add('hidden'); step3State1.classList.remove('hidden');
                setTimeout(() => step3State1.classList.remove('opacity-0'), 50);
            }, 500);
            smsCodeInput.value = ''; 
            recordFail(3, 3, "æç¤ºï¼šä¸‡èƒ½ç æ˜¯ 000000", 5000);
        });

        verifyCodeBtn.addEventListener('click', () => {
            if (smsCodeInput.value === '000000') goToStep(4);
            else {
                showToast("éªŒè¯ç é”™è¯¯");
                recordFail(3, 3, "æç¤ºï¼šä¸‡èƒ½ç æ˜¯ 000000", 5000);
            }
        });

        // å…³å¡ 4ï¼šä¿„ç½—æ–¯å¥—å¨ƒ + æƒ…ç»ªéœ‡åŠ¨ & åˆ®åˆ®ä¹
        const pwdInput = document.getElementById('passwordInput'), rulesContainer = document.getElementById('rulesContainer');
        const pwdNextBtn = document.getElementById('pwdNextBtn'), secretPwdDisplay = document.getElementById('secretPasswordDisplay');
        const currentMonth = new Date().toLocaleString('en-US', { month: 'short' });
        const pwdRules = [
            { id: 'r1', text: 'å¯†ç å¿…é¡»åŒ…å«è‡³å°‘ 8 ä¸ªå­—ç¬¦', check: (v) => v.length >= 8 },
            { id: 'r2', text: 'å¿…é¡»åŒ…å«ä¸€ä¸ªå¤§å†™å­—æ¯', check: (v) => /[A-Z]/.test(v) },
            { id: 'r3', text: 'å¯†ç é•¿åº¦å¿…é¡»æ˜¯ä¸€ä¸ªç´ æ•° (å¦‚ 11, 13, 17)', check: (v) => { const num = v.length; if (num <= 1) return false; for(let i=2; i<=Math.sqrt(num); i++) if(num%i===0) return false; return true; }},
            { id: 'r4', text: `éœ€åŒ…å«æ‚¨å½“å‰æœˆä»½çš„è‹±æ–‡ç¼©å†™ (${currentMonth})`, check: (v) => v.includes(currentMonth) },
            { id: 'r5', text: 'æ‰€æœ‰æ•°å­—ç›¸åŠ çš„æ€»å’Œå¿…é¡»ç­‰äº 25', check: (v) => { const nums = v.match(/\d/g); if (!nums) return false; return nums.reduce((acc, curr) => acc + parseInt(curr), 0) === 25; }}
        ];
        let currentRuleIndex = 0;

        function renderRule(index, isSuccess) {
            const rule = pwdRules[index]; let el = document.getElementById(rule.id);
            if (!el) {
                el = document.createElement('div'); el.id = rule.id;
                el.className = 'flex items-center gap-2 opacity-0 transition-opacity duration-700 text-gray-400';
                el.innerHTML = `<div class="w-4 h-4 rounded-full border border-current flex items-center justify-center icon-box transition-colors"></div><span>${rule.text}</span>`;
                rulesContainer.appendChild(el); void el.offsetWidth; el.classList.remove('opacity-0');
            }
            const iconBox = el.querySelector('.icon-box');
            if (isSuccess) {
                el.classList.replace('text-gray-400', 'text-black'); iconBox.classList.add('bg-black', 'border-black');
                iconBox.innerHTML = `<svg class="w-3 h-3 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>`;
            } else {
                el.classList.replace('text-black', 'text-gray-400'); iconBox.classList.remove('bg-black', 'border-black'); iconBox.innerHTML = '';
            }
        }
        renderRule(0, false);

        pwdInput.addEventListener('input', (e) => {
            const val = e.target.value;
            secretPwdDisplay.textContent = val.length > 0 ? val.substring(0, 10) + (val.length>10?'...':'') : '****';
            if (val.includes('!') || val.includes('?') || val.includes('ï¼') || val.includes('ï¼Ÿ')) {
                pwdInput.classList.remove('shake-anim'); void pwdInput.offsetWidth; pwdInput.classList.add('shake-anim');
            }
            let allPassedSoFar = true;
            for (let i = 0; i <= currentRuleIndex; i++) {
                const passed = pwdRules[i].check(val); renderRule(i, passed); if (!passed) allPassedSoFar = false;
            }
            if (allPassedSoFar && currentRuleIndex < pwdRules.length - 1) {
                currentRuleIndex++; renderRule(currentRuleIndex, false); allPassedSoFar = false; 
            }
            if (allPassedSoFar && currentRuleIndex === pwdRules.length - 1) {
                pwdNextBtn.classList.remove('opacity-0', 'pointer-events-none');
            } else { pwdNextBtn.classList.add('opacity-0', 'pointer-events-none'); }
        });

        pwdInput.addEventListener('keydown', (e) => {
            if (e.key === 'Backspace' || e.key === 'Delete') recordFail(4, 20, `æç¤ºï¼šA11111111111111225${currentMonth}`, 6000);
        });

        const scratchCanvas = document.getElementById('scratchCanvas');
        let scratchCtx, isScratching = false;

        function initScratchCard() {
            scratchCtx = scratchCanvas.getContext('2d');
            scratchCanvas.width = scratchCanvas.offsetWidth; scratchCanvas.height = scratchCanvas.offsetHeight;
            let gradient = scratchCtx.createLinearGradient(0, 0, scratchCanvas.width, scratchCanvas.height);
            gradient.addColorStop(0, '#e5e7eb'); gradient.addColorStop(0.5, '#d1d5db'); gradient.addColorStop(1, '#9ca3af');
            scratchCtx.fillStyle = gradient; scratchCtx.fillRect(0, 0, scratchCanvas.width, scratchCanvas.height);
            scratchCtx.font = "12px sans-serif"; scratchCtx.fillStyle = "#6b7280"; scratchCtx.textAlign = "center";
            scratchCtx.fillText("åˆ®å¼€æŸ¥çœ‹", scratchCanvas.width/2, scratchCanvas.height/2 + 4);
            scratchCtx.globalCompositeOperation = 'destination-out';
        }

        function scratch(e) {
            if(!isScratching) return;
            const rect = scratchCanvas.getBoundingClientRect(), x = e.clientX - rect.left, y = e.clientY - rect.top;
            scratchCtx.beginPath(); scratchCtx.arc(x, y, 12, 0, Math.PI * 2); scratchCtx.fill();
        }

        scratchCanvas.addEventListener('mousedown', () => isScratching = true);
        window.addEventListener('mouseup', () => isScratching = false);
        scratchCanvas.addEventListener('mousemove', scratch);
        scratchCanvas.addEventListener('touchstart', (e) => { isScratching = true; scratch(e.touches[0]); });
        scratchCanvas.addEventListener('touchend', () => isScratching = false);
        scratchCanvas.addEventListener('touchmove', (e) => { e.preventDefault(); scratch(e.touches[0]); });

        pwdNextBtn.addEventListener('click', () => goToStep(5));

        // å…³å¡ 5ï¼šæçª„ç«çº¿æ»‘å—éªŒè¯
        const captchaDot = document.getElementById('captchaDot'), captchaPath = document.getElementById('captchaPath'), step5Svg = document.getElementById('captchaSvg');
        let isDragging = false;

        function getDotStartPos() {
            const r = step5Svg.getBoundingClientRect();
            return { left: Math.round(50 * r.width / 500) - 10, top: 65 };
        }
        function resetDot() {
            const pos = getDotStartPos();
            captchaDot.style.transition = 'all 0.3s ease';
            captchaDot.style.left = pos.left + 'px'; captchaDot.style.top = pos.top + 'px';
            setTimeout(() => { captchaDot.style.transition = 'box-shadow 0.2s'; }, 300);
        }
        requestAnimationFrame(() => { const p = getDotStartPos(); captchaDot.style.left = p.left + 'px'; captchaDot.style.top = p.top + 'px'; });

        function handleCaptchaMove(clientX, clientY) {
            if (!isDragging || !document.getElementById('step5').classList.contains('active')) return;
            const svgRect = step5Svg.getBoundingClientRect();
            const x = clientX - svgRect.left, y = clientY - svgRect.top;
            captchaDot.style.left = (x - 10) + 'px'; captchaDot.style.top = (y - 10) + 'px';
            captchaDot.style.pointerEvents = 'none';
            const elUnder = document.elementFromPoint(clientX, clientY);
            captchaDot.style.pointerEvents = 'auto';
            if (elUnder !== captchaPath) {
                isDragging = false; captchaDot.style.cursor = 'grab'; captchaDot.style.boxShadow = 'none'; showToast("åäº†ï¼Œé‡æ¥");
                captchaDot.classList.add('bg-red-500'); setTimeout(() => captchaDot.classList.remove('bg-red-500'), 300);
                resetDot(); recordFail(5, 5, "æç¤ºï¼šåŒ€é€Ÿæ‹–è¿‡å»", 4000); return;
            }
            if (x > svgRect.width * 0.88) { isDragging = false; showToast("éªŒè¯æˆåŠŸï¼"); setTimeout(() => goToStep(6), 1000); }
        }

        captchaDot.addEventListener('mousedown', () => { isDragging = true; captchaDot.style.cursor = 'grabbing'; captchaDot.style.boxShadow = '0 0 0 4px rgba(0,0,0,0.1)'; });
        captchaDot.addEventListener('touchstart', (e) => { e.preventDefault(); isDragging = true; captchaDot.style.boxShadow = '0 0 0 4px rgba(0,0,0,0.1)'; }, { passive: false });
        window.addEventListener('mouseup', () => {
            if (isDragging) { isDragging = false; captchaDot.style.cursor = 'grab'; captchaDot.style.boxShadow = 'none'; resetDot(); }
        });
        window.addEventListener('touchend', () => {
            if (isDragging) { isDragging = false; captchaDot.style.boxShadow = 'none'; resetDot(); }
        });
        window.addEventListener('mousemove', (e) => { handleCaptchaMove(e.clientX, e.clientY); });
        window.addEventListener('touchmove', (e) => { if (isDragging) handleCaptchaMove(e.touches[0].clientX, e.touches[0].clientY); }, { passive: true });

        // å…³å¡ 6ï¼šç‰µä¸€å‘è€ŒåŠ¨å…¨èº«é€€è®¢
        const toggleGrid = document.getElementById('toggleGrid'), finalSubmitBtn = document.getElementById('finalSubmitBtn'), resetStep6Btn = document.getElementById('resetStep6Btn');
        const gridSize = 3; let togglesState = [1, 1, 1, 1, 1, 1, 1, 1, 1];
        function renderToggles() {
            toggleGrid.innerHTML = '';
            togglesState.forEach((state, index) => {
                const label = document.createElement('label'); label.className = 'flex flex-col items-center gap-2';
                const checkbox = document.createElement('input'); checkbox.type = 'checkbox'; checkbox.className = 'ios-toggle'; checkbox.checked = state === 1;
                checkbox.addEventListener('click', (e) => { e.preventDefault(); handleToggleClick(index); });
                const span = document.createElement('span'); span.className = 'text-xs text-gray-400 font-medium'; span.textContent = `æ¡æ¬¾ 0${index + 1}`;
                label.appendChild(checkbox); label.appendChild(span); toggleGrid.appendChild(label);
            });
            checkFinalWin();
        }
        function handleToggleClick(index) {
            const row = Math.floor(index / gridSize); const col = index % gridSize;
            flip(row, col); flip(row - 1, col); flip(row + 1, col); flip(row, col - 1); flip(row, col + 1);
            renderToggles(); recordFail(6, 25, "æç¤ºï¼šå…ˆç‚¹å››è§’ï¼Œå†ç‚¹ä¸­é—´", 6000);
        }
        function flip(r, c) { if (r >= 0 && r < gridSize && c >= 0 && c < gridSize) { const idx = r * gridSize + c; togglesState[idx] = togglesState[idx] === 1 ? 0 : 1; } }
        function checkFinalWin() {
            if (togglesState.every(s => s === 0)) { finalSubmitBtn.classList.remove('opacity-30', 'pointer-events-none'); finalSubmitBtn.classList.add('cursor-pointer'); } 
            else { finalSubmitBtn.classList.add('opacity-30', 'pointer-events-none'); finalSubmitBtn.classList.remove('cursor-pointer'); }
        }
        renderToggles();
        resetStep6Btn.addEventListener('click', () => { togglesState = [1, 1, 1, 1, 1, 1, 1, 1, 1]; renderToggles(); });
        finalSubmitBtn.addEventListener('click', () => { failCounterWidget.classList.add('hidden'); goToStep(7); });

        function triggerVictory() {
            document.getElementById('finalFailCount').textContent = totalFails;
            document.getElementById('finalMinutes').textContent = Math.max(1, Math.ceil((Date.now() - startTime) / 60000));
            victoryText.classList.remove('opacity-0', 'pointer-events-none');
        }

        // å…³å¡ 7ï¼šé»‘æ´é”€æ¯ç»“å±€
        const archiveCard = document.getElementById('archiveCard'), blackHole = document.getElementById('blackHole'), victoryText = document.getElementById('victoryText');
        let isCardDragging = false, cardOffset = { x: 0, y: 0 };
        archiveCard.addEventListener('mousedown', (e) => {
            isCardDragging = true; const rect = archiveCard.getBoundingClientRect();
            cardOffset.x = e.clientX - rect.left; cardOffset.y = e.clientY - rect.top;
            archiveCard.style.cursor = 'grabbing'; archiveCard.style.transition = 'none'; 
        });
        window.addEventListener('mousemove', (e) => {
            if (!isCardDragging || !document.getElementById('step7').classList.contains('active')) return;
            const newX = e.clientX - cardOffset.x, newY = e.clientY - cardOffset.y;
            archiveCard.style.left = `${newX}px`; archiveCard.style.top = `${newY}px`; archiveCard.style.bottom = 'auto'; 

            const holeRect = blackHole.getBoundingClientRect(), cardRect = archiveCard.getBoundingClientRect();
            const holeCenter = { x: holeRect.left + holeRect.width/2, y: holeRect.top + holeRect.height/2 }, cardCenter = { x: cardRect.left + cardRect.width/2, y: cardRect.top + cardRect.height/2 };
            const dist = Math.sqrt(Math.pow(holeCenter.x - cardCenter.x, 2) + Math.pow(holeCenter.y - cardCenter.y, 2));

            if (dist < 80) {
                isCardDragging = false;
                archiveCard.style.left = `${holeCenter.x - cardRect.width/2}px`; archiveCard.style.top = `${holeCenter.y - cardRect.height/2}px`;
                void archiveCard.offsetWidth; archiveCard.classList.add('sucked-in');
                setTimeout(triggerVictory, 1000);
            }
        });
        window.addEventListener('mouseup', () => { if (isCardDragging) { isCardDragging = false; archiveCard.style.cursor = 'grab'; archiveCard.style.transition = 'transform 0.3s ease'; } });
        archiveCard.addEventListener('touchstart', (e) => {
            e.preventDefault();
            isCardDragging = true; const rect = archiveCard.getBoundingClientRect();
            cardOffset.x = e.touches[0].clientX - rect.left; cardOffset.y = e.touches[0].clientY - rect.top;
            archiveCard.style.transition = 'none';
        }, { passive: false });
        window.addEventListener('touchmove', (e) => {
            if (!isCardDragging || !document.getElementById('step7').classList.contains('active')) return;
            const touch = e.touches[0];
            const newX = touch.clientX - cardOffset.x, newY = touch.clientY - cardOffset.y;
            archiveCard.style.left = `${newX}px`; archiveCard.style.top = `${newY}px`; archiveCard.style.bottom = 'auto';
            const holeRect = blackHole.getBoundingClientRect(), cardRect = archiveCard.getBoundingClientRect();
            const holeCenter = { x: holeRect.left + holeRect.width/2, y: holeRect.top + holeRect.height/2 };
            const cardCenter = { x: cardRect.left + cardRect.width/2, y: cardRect.top + cardRect.height/2 };
            const dist = Math.sqrt(Math.pow(holeCenter.x - cardCenter.x, 2) + Math.pow(holeCenter.y - cardCenter.y, 2));
            if (dist < 80) {
                isCardDragging = false;
                archiveCard.style.left = `${holeCenter.x - cardRect.width/2}px`; archiveCard.style.top = `${holeCenter.y - cardRect.height/2}px`;
                void archiveCard.offsetWidth; archiveCard.classList.add('sucked-in');
                setTimeout(triggerVictory, 1000);
            }
        }, { passive: true });
        window.addEventListener('touchend', () => { if (isCardDragging) { isCardDragging = false; archiveCard.style.transition = 'transform 0.3s ease'; } });

    </script>
</body>
</html>